# FL-Visualization è”é‚¦å­¦ä¹ å¯è§†åŒ–å¹³å°

![Python](https://img.shields.io/badge/Python-3.12.4-blue.svg)
![Flask](https://img.shields.io/badge/Flask-3.0.3-green.svg)
![PyTorch](https://img.shields.io/badge/PyTorch-2.6.0-red.svg)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

## ğŸ“– é¡¹ç›®ç®€ä»‹

FL-Visualization æ˜¯ä¸€ä¸ªåŸºäºWebçš„è”é‚¦å­¦ä¹ å¯è§†åŒ–å¹³å°ï¼Œä¸“æ³¨äºåŒ»å­¦å½±åƒï¼ˆLUNA16è‚ºç»“èŠ‚æ£€æµ‹ï¼‰çš„åˆ†å¸ƒå¼æœºå™¨å­¦ä¹ ã€‚è¯¥é¡¹ç›®å®ç°äº†å®Œæ•´çš„è”é‚¦å­¦ä¹ å·¥ä½œæµï¼ŒåŒ…æ‹¬å®¢æˆ·ç«¯æ•°æ®ä¸Šä¼ ã€æ¨¡å‹è®­ç»ƒã€æ¨ç†é¢„æµ‹å’Œå®æ—¶ç›‘æ§ã€‚

### ğŸ¯ ä¸»è¦ç‰¹æ€§

- **ğŸ” å¤šç”¨æˆ·ç³»ç»Ÿ** - æ”¯æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è§’è‰²ï¼Œå…·å¤‡å®Œæ•´çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
- **ğŸ“ åŒ»å­¦å½±åƒå¤„ç†** - æ”¯æŒMHD/RAWæ ¼å¼çš„åŒ»å­¦å½±åƒæ–‡ä»¶ä¸Šä¼ å’Œå¤„ç†
- **ğŸ¤– è”é‚¦å­¦ä¹ ** - å®ç°FedAvgç®—æ³•çš„åˆ†å¸ƒå¼æ¨¡å‹è®­ç»ƒ
- **ğŸ“Š å®æ—¶ç›‘æ§** - WebSocketå®æ—¶æ˜¾ç¤ºè®­ç»ƒè¿›åº¦å’ŒçŠ¶æ€
- **ğŸ” æ¨¡å‹æ¨ç†** - æ”¯æŒè®­ç»ƒåæ¨¡å‹çš„æ¨ç†é¢„æµ‹åŠŸèƒ½
- **ğŸ—„ï¸ æ•°æ®å­˜å‚¨** - æ”¯æŒSupabaseäº‘æ•°æ®åº“å’Œæœ¬åœ°å­˜å‚¨åŒé‡æ–¹æ¡ˆ
- **ğŸ§ª å®Œæ•´æµ‹è¯•** - åŒ…å«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
FL-Visualization/
â”œâ”€â”€ å‰ç«¯ç•Œé¢ (Flask Templates + SocketIO)
â”œâ”€â”€ åç«¯æœåŠ¡ (Flask + WebSocket)
â”œâ”€â”€ è”é‚¦å­¦ä¹ å¼•æ“ (PyTorch + FedAvg)
â”œâ”€â”€ æ•°æ®å­˜å‚¨ (Supabase + Local JSON)
â””â”€â”€ æµ‹è¯•å¥—ä»¶ (pytest + coverage)
```

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| **Webæ¡†æ¶** | Flask | 3.0.3 |
| **å®æ—¶é€šä¿¡** | Flask-SocketIO | 5.5.1 |
| **æœºå™¨å­¦ä¹ ** | PyTorch | 2.6.0 |
| **åŒ»å­¦å½±åƒ** | SimpleITK | 2.5.0 |
| **æ•°æ®åˆ†æ** | NumPy, Pandas | 1.26.4, 2.2.2 |
| **æ•°æ®åº“** | Supabase | 2.15.2 |
| **æµ‹è¯•æ¡†æ¶** | pytest | 7.4.3 |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.12.4+
- æ”¯æŒCUDAçš„GPU (æ¨èï¼Œç”¨äºæ¨¡å‹è®­ç»ƒ)


### 1. å…‹éš†é¡¹ç›®

```bash
git clone git@github.com:Tony-1203/FL-Visualization.git
cd FL-Visualization/code
```

### 2. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ– venv\Scripts\activate  # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼ˆå¯é€‰ï¼Œç”¨äºSupabaseé›†æˆï¼‰ï¼š

```bash
# Supabaseé…ç½® (å¯é€‰)
SUPABASE_URL=your_supabase_project_url
SUPABASE_KEY=your_supabase_anon_key

# Flaské…ç½®
FLASK_ENV=development
SECRET_KEY=your_secret_key_here
```

### 4. å¯åŠ¨åº”ç”¨

```bash
python app.py
```

è®¿é—® `http://localhost:5000` å¼€å§‹ä½¿ç”¨ï¼

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### ğŸ” ç”¨æˆ·è§’è‰²

#### æœåŠ¡å™¨ç®¡ç†å‘˜
- æŸ¥çœ‹æ‰€æœ‰å®¢æˆ·ç«¯çŠ¶æ€
- å¯åŠ¨è”é‚¦å­¦ä¹ è®­ç»ƒ
- ç›‘æ§è®­ç»ƒè¿›åº¦
- ä¸‹è½½è®­ç»ƒå¥½çš„æ¨¡å‹

#### å®¢æˆ·ç«¯ç”¨æˆ·
- ä¸Šä¼ åŒ»å­¦å½±åƒæ•°æ®
- å‚ä¸è”é‚¦å­¦ä¹ è®­ç»ƒ
- æŸ¥çœ‹ä¸ªäººè®­ç»ƒå†å²
- æ‰§è¡Œæ¨¡å‹æ¨ç†

### ğŸ“ æ•°æ®æ ¼å¼æ”¯æŒ

- **MHDæ ¼å¼**: MetaImageå¤´æ–‡ä»¶ï¼ŒåŒ…å«å½±åƒå…ƒæ•°æ®
- **RAWæ ¼å¼**: å¯¹åº”çš„åŸå§‹å½±åƒæ•°æ®æ–‡ä»¶
- **æ–‡ä»¶å¯¹**: æ¯ä¸ªå½±åƒéœ€è¦å¯¹åº”çš„.mhdå’Œ.rawæ–‡ä»¶

#### ç¤ºä¾‹æ–‡ä»¶ç»“æ„
```
uploads/
â”œâ”€â”€ client1_data/
â”‚   â”œâ”€â”€ scan001.mhd
â”‚   â”œâ”€â”€ scan001.raw
â”‚   â”œâ”€â”€ scan002.mhd
â”‚   â””â”€â”€ scan002.raw
â””â”€â”€ client2_data/
    â”œâ”€â”€ lung_ct_001.mhd
    â””â”€â”€ lung_ct_001.raw
```

### ğŸ¤– è”é‚¦å­¦ä¹ æµç¨‹

1. **æ•°æ®å‡†å¤‡**: å®¢æˆ·ç«¯ä¸Šä¼ åŒ»å­¦å½±åƒæ•°æ®
2. **è®­ç»ƒå¯åŠ¨**: æœåŠ¡å™¨ç®¡ç†å‘˜å¯åŠ¨è”é‚¦å­¦ä¹ ä»»åŠ¡
3. **æœ¬åœ°è®­ç»ƒ**: å„å®¢æˆ·ç«¯åœ¨æœ¬åœ°æ•°æ®ä¸Šè®­ç»ƒæ¨¡å‹
4. **æ¨¡å‹èšåˆ**: æœåŠ¡å™¨èšåˆå®¢æˆ·ç«¯æ¨¡å‹æ›´æ–°
5. **è¿­ä»£ä¼˜åŒ–**: é‡å¤è®­ç»ƒå’Œèšåˆè¿‡ç¨‹
6. **æ¨¡å‹æ¨ç†**: ä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹


## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### ğŸ–¥ï¸ Webç•Œé¢

#### ç™»å½•é¡µé¢
- ç”¨æˆ·èº«ä»½éªŒè¯
- è§’è‰²é€‰æ‹©ï¼ˆå®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼‰
- è‡ªåŠ¨ä¼šè¯ç®¡ç†

#### å®¢æˆ·ç«¯é¢æ¿
- æ•°æ®ä¸Šä¼ ç•Œé¢
- ä¸Šä¼ å†å²æŸ¥çœ‹
- è®­ç»ƒè¿›åº¦ç›‘æ§
- æ¨ç†åŠŸèƒ½ä½¿ç”¨

#### æœåŠ¡å™¨é¢æ¿
- å®¢æˆ·ç«¯çŠ¶æ€æ€»è§ˆ
- è”é‚¦å­¦ä¹ æ§åˆ¶
- è®­ç»ƒå†å²ç®¡ç†
- ç³»ç»Ÿæ—¥å¿—æŸ¥çœ‹

### ğŸ”„ å®æ—¶åŠŸèƒ½

- **WebSocketé€šä¿¡** - å®æ—¶çŠ¶æ€æ›´æ–°
- **è¿›åº¦ç›‘æ§** - è®­ç»ƒè¿‡ç¨‹å®æ—¶æ˜¾ç¤º
- **æ—¥å¿—æ¨é€** - ç³»ç»Ÿæ¶ˆæ¯å®æ—¶é€šçŸ¥
- **çŠ¶æ€åŒæ­¥** - å¤šç”¨æˆ·çŠ¶æ€åŒæ­¥

### ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

- **å¯†ç åŠ å¯†** - bcryptå“ˆå¸ŒåŠ å¯†
- **ä¼šè¯ç®¡ç†** - å®‰å…¨çš„ç”¨æˆ·ä¼šè¯
- **æ–‡ä»¶éªŒè¯** - ä¸Šä¼ æ–‡ä»¶æ ¼å¼éªŒè¯
- **æƒé™æ§åˆ¶** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶

## ğŸ”§ é…ç½®è¯´æ˜


### è”é‚¦å­¦ä¹ å‚æ•°

```python
# src/federated_training.py ä¸­çš„è®­ç»ƒå‚æ•°
training_params = {
    "rounds": 10,              # è”é‚¦å­¦ä¹ è½®æ•°
    "epochs_per_round": 2,     # æ¯è½®æœ¬åœ°è®­ç»ƒè½®æ•°
    "learning_rate": 0.001,    # å­¦ä¹ ç‡
    "batch_size": 4,           # æ‰¹å¤„ç†å¤§å°
    "num_workers": 2           # æ•°æ®åŠ è½½å™¨å·¥ä½œè¿›ç¨‹æ•°
}
```

## ğŸ“± APIæ–‡æ¡£

### æ–‡ä»¶ä¸Šä¼ API

```http
POST /client/upload
Content-Type: multipart/form-data

å‚æ•°:
- files: åŒ»å­¦å½±åƒæ–‡ä»¶åˆ—è¡¨

å“åº”:
{
    "message": "æˆåŠŸä¸Šä¼  N ä¸ªæ–‡ä»¶",
    "uploaded_files": ["file1.mhd", "file2.raw"],
    "total_files": 4,
    "mhd_count": 2,
    "raw_count": 2
}
```

### è®­ç»ƒå¯åŠ¨API

```http
POST /server/start_training
Content-Type: application/json

{
    "rounds": 10,
    "epochs_per_round": 2,
    "learning_rate": 0.001
}
```

### æ¨ç†API

```http
POST /api/server/run_inference
Content-Type: application/json

{
    "model_session": 1,
    "image_file": "scan001.mhd"
}
```

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
FL-Visualization/
â”œâ”€â”€ code/                           # ä¸»è¦ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ app.py                     # Flaskä¸»åº”ç”¨
â”‚   â”œâ”€â”€ requirements.txt           # Pythonä¾èµ–
â”‚   â”œâ”€â”€ .env                       # ç¯å¢ƒå˜é‡(éœ€åˆ›å»º)
â”‚   â”œâ”€â”€ local_users.json          # æœ¬åœ°ç”¨æˆ·æ•°æ®
â”‚   â”œâ”€â”€ training_history.json     # è®­ç»ƒå†å²è®°å½•
â”‚   â”‚
â”‚   â”œâ”€â”€ src/                       # è”é‚¦å­¦ä¹ æ ¸å¿ƒä»£ç 
â”‚   â”‚   â”œâ”€â”€ federated_training.py # è”é‚¦å­¦ä¹ è®­ç»ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ federated_inference.py# æ¨¡å‹æ¨ç†åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ federated_inference_utils.py # æ¨ç†å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ show_nodules.py       # ç»“èŠ‚å¯è§†åŒ–
â”‚   â”‚   â””â”€â”€ annotations.csv       # æ ‡æ³¨æ•°æ®
â”‚   â”‚
â”‚   â”œâ”€â”€ templates/                 # HTMLæ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ login.html            # ç™»å½•é¡µé¢
â”‚   â”‚   â”œâ”€â”€ client_dashboard.html # å®¢æˆ·ç«¯é¢æ¿
â”‚   â”‚   â”œâ”€â”€ server_dashboard.html # æœåŠ¡å™¨é¢æ¿
â”‚   â”‚   â”œâ”€â”€ client_history.html   # å®¢æˆ·ç«¯å†å²
â”‚   â”‚   â””â”€â”€ server_history.html   # æœåŠ¡å™¨å†å²
â”‚   â”‚
â”‚   â”œâ”€â”€ static/                    # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ css/                  # æ ·å¼æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ js/                   # JavaScriptæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ training_images/      # è®­ç»ƒå›¾åƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ tests/                     # æµ‹è¯•å¥—ä»¶
â”‚   â”‚   â”œâ”€â”€ test_app.py           # ä¸»åº”ç”¨æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_federated_learning.py # è”é‚¦å­¦ä¹ æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test_performance_integration.py # æ€§èƒ½é›†æˆæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ conftest.py           # pytesté…ç½®
â”‚   â”‚   â””â”€â”€ README.md             # æµ‹è¯•æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ uploads/                   # æ–‡ä»¶ä¸Šä¼ ç›®å½•
â”‚   â”‚   â”œâ”€â”€ client1_data/         # å®¢æˆ·ç«¯1æ•°æ®
â”‚   â”‚   â”œâ”€â”€ client2_data/         # å®¢æˆ·ç«¯2æ•°æ®
â”‚   â”‚   â”œâ”€â”€ server_inference/     # æœåŠ¡å™¨æ¨ç†æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ client_inference/     # å®¢æˆ·ç«¯æ¨ç†æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                    # è®­ç»ƒæ¨¡å‹å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ session_1_federated_model.pth
â”‚   â”‚   â””â”€â”€ best_federated_lung_nodule_model.pth
â”‚   â”‚
â”‚   â”œâ”€â”€ dummy_data/               # ç¤ºä¾‹æ•°æ®
â”‚   â”‚   â”œâ”€â”€ *.mhd                # ç¤ºä¾‹MHDæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ *.raw                # ç¤ºä¾‹RAWæ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ pytest.ini               # pytesté…ç½®
â”‚   â”œâ”€â”€ run_tests.py             # å®Œæ•´æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ quick_test.py            # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ æµ‹è¯•å¥—ä»¶æ€»ç»“.md           # æµ‹è¯•æ€»ç»“æ–‡æ¡£
â”‚   â””â”€â”€ é—®é¢˜è§£å†³æŠ¥å‘Š.md           # é—®é¢˜è§£å†³è®°å½•
â”‚
â””â”€â”€ report/                       # é¡¹ç›®æŠ¥å‘Šæ–‡æ¡£
    â”œâ”€â”€ 1. æºä»£ç å’Œç›¸å…³æ–‡æ¡£/
    â”œâ”€â”€ 2. éœ€æ±‚åˆ†ææŠ¥å‘Š/
    â”œâ”€â”€ 3. ç³»ç»Ÿå»ºæ¨¡æŠ¥å‘Š/
    â”œâ”€â”€ 4. æ¶æ„è®¾è®¡æ–‡æ¡£/
    â”œâ”€â”€ 5. å·¥ç¨‹åŒ–è¯´æ˜æ–‡æ¡£/
    â”œâ”€â”€ 6. æµ‹è¯•ä¸è´¨é‡æŠ¥å‘Š/
    â”œâ”€â”€ 7. é…ç½®ä¸è¿ç»´æ–‡æ¡£/
    â”œâ”€â”€ 8. å›¢é˜ŸæŠ¥å‘Š/
    â”œâ”€â”€ 9. æ¼”ç¤ºè§†é¢‘/
    â””â”€â”€ 10. ä¸ªäººå¿ƒå¾—/
```

## ğŸ› å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æç¤º"ModuleNotFoundError"ï¼Ÿ
A: ç¡®ä¿å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

å¦‚æœè¿˜æœ‰åˆ«çš„æœªå®‰è£…çš„æ¨¡å—ï¼Œè¯·æ ¹æ®é”™è¯¯æç¤ºå®‰è£…ã€‚

### Q: æ— æ³•è¿æ¥Supabaseæ•°æ®åº“ï¼Ÿ
A: æ£€æŸ¥`.env`æ–‡ä»¶é…ç½®ï¼Œæˆ–åˆ é™¤é…ç½®ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ¨¡å¼ã€‚

### Q: æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥æ–‡ä»¶æ ¼å¼ï¼ˆéœ€è¦.mhdå’Œ.rawé…å¯¹ï¼‰å’Œæ–‡ä»¶å¤§å°é™åˆ¶ã€‚

### Q: è®­ç»ƒè¿‡ç¨‹ä¸­æ–­ï¼Ÿ
A: æ£€æŸ¥ç³»ç»Ÿå†…å­˜å’ŒGPUèµ„æºï¼Œå¯ä»¥å‡å°‘batch_sizeå‚æ•°ã€‚


## ğŸ¯ æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤šåŒ»å­¦å½±åƒæ ¼å¼ (DICOM, NIfTI)
- [ ] æ·»åŠ æ›´å¤šè”é‚¦å­¦ä¹ ç®—æ³• (FedProx, SCAFFOLD)
- [ ] å®ç°å·®åˆ†éšç§ä¿æŠ¤
- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] Dockerå®¹å™¨åŒ–éƒ¨ç½²
- [ ] é›†ç¾¤éƒ¨ç½²æ”¯æŒ
- [ ] æ›´ä¸°å¯Œçš„å¯è§†åŒ–å›¾è¡¨
- [ ] æ¨¡å‹æ€§èƒ½å¯¹æ¯”åˆ†æ

